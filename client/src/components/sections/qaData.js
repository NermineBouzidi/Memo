const chatbotData = {
  welcome_message: "üëã Bonjour et bienvenue ! Je suis l√† pour r√©pondre √† vos questions sur CRP MEMO.",
  quick_replies: [
    { label: "√Ä propos de CRP MEMO", payload: "about" },
    { label: "Fonctionnalit√©s", payload: "features" },
    { label: "Avantages", payload: "benefits" },
    { label: "Tarification", payload: "pricing" },
    { label: "Mise en ≈ìuvre", payload: "implementation" },
    { label: "Public cible", payload: "target" },
    { label: "D√©tails techniques", payload: "technical" },
    { label: "Personnalisation", payload: "customization" },
    { label: "Marque & Contact", payload: "trademark" },
    { label: "SWOT", payload: "swot" },
  ],
  reponses: {
    about: [
      {
        question: "Qu‚Äôest-ce que CRP MEMO ?",
        keyword: "questcecrpmemo",
        answer: "CRP MEMO est une solution hybride entre un logiciel standard (type SAGE) et une solution sur mesure (type SAP), ajust√©e aux besoins m√©tiers.",
        keywords: [
          // Mot-cl√© principal
          "questcecrpmemo",
          // Variations de la question
          "qu'est-ce que CRP MEMO",
          "CRP MEMO c'est quoi",
          "d√©finition CRP MEMO",
          "qu'est-ce que le CRP MEMO",
          // Termes sp√©cifiques
          "logiciel hybride",
          "solution sur mesure",
          "besoins m√©tiers",
          // Termes g√©n√©raux et synonymes
          "pr√©sentation CRP MEMO",
          "CRP MEMO logiciel",
          "description CRP MEMO",
          // Phrases naturelles
          "CRP MEMO explication",
          "qu‚Äôest-ce que fait CRP MEMO",
          "√† quoi sert CRP MEMO"
        ]
      },
      {
        question: "Quels sont les points forts du produit ?",
        keyword: "pointsforts",
        answer: "Sur-mesure, prix comp√©titif, expertise m√©tier, d√©lai court, GED int√©gr√©e, service client r√©actif, √©volutivit√©, tarification au forfait.",
        keywords: [
          // Mot-cl√© principal
          "pointsforts",
          // Variations de la question
          "avantages CRP MEMO",
          "points forts produit",
          "atouts CRP MEMO",
          // Termes sp√©cifiques
          "sur-mesure",
          "prix comp√©titif",
          "expertise m√©tier",
          "GED int√©gr√©e",
          "service client r√©actif",
          "√©volutivit√©",
          "tarification forfait",
          // Termes g√©n√©raux et synonymes
          "qualit√©s CRP MEMO",
          "b√©n√©fices produit",
          "forces CRP MEMO",
          // Phrases naturelles
          "pourquoi choisir CRP MEMO",
          "avantages du logiciel",
          "points forts CRP MEMO"
        ]
      },
    ],
    features: [
      {
        question: "Quelles sont les fonctionnalit√©s cl√©s de CRP MEMO ?",
        keyword: "fonctionnalitescles",
        answer: "Suivi temps r√©el, g√©n√©ration d‚Äô√©critures comptables, gestion RH, stocks, notes de frais, KPIs, pr√©paration √† la facturation √©lectronique.",
        keywords: [
          // Mot-cl√© principal
          "fonctionnalitescles",
          // Variations de la question
          "fonctions CRP MEMO",
          "caract√©ristiques CRP MEMO",
          "outils CRP MEMO",
          // Termes sp√©cifiques
          "suivi temps r√©el",
          "√©critures comptables",
          "gestion RH",
          "gestion stocks",
          "notes de frais",
          "KPIs",
          "facturation √©lectronique",
          // Termes g√©n√©raux et synonymes
          "features CRP MEMO",
          "capacit√©s logiciel",
          "fonctionnalit√©s logiciel",
          // Phrases naturelles
          "ce que fait CRP MEMO",
          "outils propos√©s CRP MEMO",
          "fonctions principales"
        ]
      },
    ],
    benefits: [
      {
        question: "Quels sont les b√©n√©fices pour les clients ?",
        keyword: "beneficesclients",
        answer: "Am√©lioration rentabilit√©, r√©duction d√©lais paiement, centralisation des donn√©es, simplification administrative, accompagnement sur mesure.",
        keywords: [
          // Mot-cl√© principal
          "beneficesclients",
          // Variations de la question
          "avantages pour clients",
          "b√©n√©fices CRP MEMO",
          "gains pour entreprise",
          // Termes sp√©cifiques
          "am√©lioration rentabilit√©",
          "r√©duction d√©lais paiement",
          "centralisation donn√©es",
          "simplification administrative",
          "accompagnement sur mesure",
          // Termes g√©n√©raux et synonymes
          "int√©r√™ts CRP MEMO",
          "valeur ajout√©e",
          "avantages utilisateurs",
          // Phrases naturelles
          "pourquoi choisir CRP MEMO",
          "b√©n√©fices utilisateurs",
          "avantages pour entreprise"
        ]
      },
    ],
    pricing: [
      {
        question: "Quel est le mod√®le de tarification ?",
        keyword: "modeletarification",
        answer: "Conception au forfait, utilisation sans r√©currence, maintenance mensuelle faible, assistance illimit√©e sans engagement.",
        keywords: [
          // Mot-cl√© principal
          "modeletarification",
          // Variations de la question
          "tarifs CRP MEMO",
          "co√ªt CRP MEMO",
          "prix logiciel",
          // Termes sp√©cifiques
          "conception forfait",
          "utilisation sans r√©currence",
          "maintenance mensuelle",
          "assistance illimit√©e",
          // Termes g√©n√©raux et synonymes
          "mod√®le de prix",
          "tarification CRP MEMO",
          "budget CRP MEMO",
          // Phrases naturelles
          "frais d'utilisation",
          "co√ªt usage CRP MEMO",
          "tarifs logiciel CRP MEMO"
        ]
      },
    ],
    implementation: [
      {
        question: "Comment CRP MEMO est-il mis en place dans mon entreprise ?",
        keyword: "miseoeuvre",
        answer: "La mise en ≈ìuvre inclut une phase pilote, une collaboration avec votre √©quipe MOA, et une int√©gration des processus m√©tier, r√©alis√©e dans un d√©lai court.",
        keywords: [
          // Mot-cl√© principal
          "miseoeuvre",
          // Variations de la question
          "mise en place CRP MEMO",
          "impl√©mentation logiciel",
          "d√©ploiement CRP MEMO",
          // Termes sp√©cifiques
          "phase pilote",
          "collaboration MOA",
          "int√©gration processus m√©tier",
          "d√©lai court",
          // Termes g√©n√©raux et synonymes
          "installation CRP MEMO",
          "processus mise en ≈ìuvre",
          "int√©gration logiciel",
          // Phrases naturelles
          "comment installer CRP MEMO",
          "d√©ploiement CRP MEMO entreprise",
          "mise en ≈ìuvre logiciel"
        ]
      },
    ],
    target: [
      {
        question: "√Ä qui s‚Äôadresse CRP MEMO ?",
        keyword: "publiccible",
        answer: "Aux TPE/PME, associations, cabinets d‚Äôarchitecture, agences web, BTP, s√©curit√©, entre 2 et 100 salari√©s et jusqu‚Äô√† 50M‚Ç¨ de CA annuel.",
        keywords: [
          // Mot-cl√© principal
          "publiccible",
          // Variations de la question
          "cible CRP MEMO",
          "qui utilise CRP MEMO",
          "clients CRP MEMO",
          // Termes sp√©cifiques
          "TPE PME",
          "associations",
          "cabinets architecture",
          "agences web",
          "BTP",
          "s√©curit√©",
          "2 √† 100 salari√©s",
          "50M‚Ç¨ CA annuel",
          // Termes g√©n√©raux et synonymes
          "audience CRP MEMO",
          "utilisateurs cibles",
          "entreprises concern√©es",
          // Phrases naturelles
          "profils clients CRP MEMO",
          "qui peut utiliser CRP MEMO",
          "entreprises adapt√©es CRP MEMO"
        ]
      },
    ],
    technical: [
      {
        question: "Qui d√©veloppe et h√©berge CRP MEMO ?",
        keyword: "developpementhebergement",
        answer: "PEGASIO INTERNATIONAL / EQUITY BUSINESS, avec des √©quipes en Tunisie et Ukraine (OVH, DigitalOcean, Maligun, Brevo).",
        keywords: [
          // Mot-cl√© principal
          "developpementhebergement",
          // Variations de la question
          "qui d√©veloppe CRP MEMO",
          "h√©bergement CRP MEMO",
          "serveurs CRP MEMO",
          // Termes sp√©cifiques
          "PEGASIO INTERNATIONAL",
          "EQUITY BUSINESS",
          "√©quipes Tunisie",
          "√©quipes Ukraine",
          "OVH",
          "DigitalOcean",
          "Maligun",
          "Brevo",
          // Termes g√©n√©raux et synonymes
          "d√©veloppeurs logiciel",
          "infrastructure CRP MEMO",
          "qui h√©berge CRP MEMO",
          // Phrases naturelles
          "√©quipe technique CRP MEMO",
          "serveurs utilis√©s CRP MEMO",
          "d√©veloppement logiciel CRP MEMO"
        ]
      },
    ],
    customization: [
      {
        question: "CRP MEMO peut-il √™tre adapt√© √† mon entreprise ?",
        keyword: "adaptation",
        answer: "Oui, 30-40 % de ses fonctionnalit√©s peuvent √™tre personnalis√©es en collaboration avec votre √©quipe MOA.",
        keywords: [
          // Mot-cl√© principal
          "adaptation",
          // Variations de la question
          "personnalisation CRP MEMO",
          "adaptation entreprise",
          "sur mesure CRP MEMO",
          // Termes sp√©cifiques
          "30-40 % fonctionnalit√©s",
          "collaboration MOA",
          "personnalisation fonctionnalit√©s",
          // Termes g√©n√©raux et synonymes
          "customisation logiciel",
          "ajustement CRP MEMO",
          "modifications possibles",
          // Phrases naturelles
          "personnaliser CRP MEMO",
          "adapter logiciel entreprise",
          "sur mesure logiciel CRP MEMO"
        ]
      },
    ],
    trademark: [
      {
        question: "Quel est le statut de la marque CRP MEMO ?",
        keyword: "statutmarque",
        answer: "CRP MEMO est une marque fran√ßaise enregistr√©e (n¬∞ 5012862) d√©pos√©e le 08-12-2023 aupr√®s de l'INPI.",
        keywords: [
          // Mot-cl√© principal
          "statutmarque",
          // Variations de la question
          "marque CRP MEMO",
          "enregistrement marque",
          "statut juridique marque",
          // Termes sp√©cifiques
          "marque fran√ßaise",
          "n¬∞ 5012862",
          "08-12-2023",
          "INPI",
          // Termes g√©n√©raux et synonymes
          "propri√©t√© marque",
          "marque d√©pos√©e",
          "d√©tails marque",
          // Phrases naturelles
          "statut l√©gal CRP MEMO",
          "enregistrement INPI",
          "marque CRP MEMO d√©tails"
        ]
      },
      {
        question: "Comment puis-je contacter le support CRP MEMO ?",
        keyword: "contactsupport",
        answer: "Vous pouvez nous √©crire √† contact@hable-solutions.com ou appeler au 07 67 27 65 22.",
        keywords: [
          // Mot-cl√© principal
          "contactsupport",
          // Variations de la question
          "contacter support",
          "assistance CRP MEMO",
          "joindre support",
          // Termes sp√©cifiques
          "contact@hable-solutions.com",
          "07 67 27 65 22",
          "email support",
          "num√©ro support",
          // Termes g√©n√©raux et synonymes
          "service client",
          "contact √©quipe",
          "support client",
          // Phrases naturelles
          "appeler support CRP MEMO",
          "email assistance CRP MEMO",
          "contacter √©quipe CRP MEMO"
        ]
      },
    ],
    swot: [
      {
        question: "Quels sont les points forts (SWOT) ?",
        keyword: "pointsfortsswot",
        answer: "Interface simple, d√©lai court, adaptation comptable, GED, consulting, flexibilit√©, plateforme en ligne, r√©activit√©, expertise.",
        keywords: [
          // Mot-cl√© principal
          "pointsfortsswot",
          // Variations de la question
          "forces SWOT",
          "atouts SWOT",
          "points forts CRP MEMO",
          // Termes sp√©cifiques
          "interface simple",
          "d√©lai court",
          "adaptation comptable",
          "GED",
          "consulting",
          "flexibilit√©",
          "plateforme en ligne",
          "r√©activit√©",
          "expertise",
          // Termes g√©n√©raux et synonymes
          "avantages SWOT",
          "qualit√©s SWOT",
          "b√©n√©fices SWOT",
          // Phrases naturelles
          "forces CRP MEMO",
          "atouts logiciel CRP MEMO",
          "points forts analyse SWOT"
        ]
      },
      {
        question: "Quelles sont les faiblesses ?",
        keyword: "faiblesses",
        answer: "Notori√©t√© faible, march√© restreint √† la gestion de projets, structure en mode start-up.",
        keywords: [
          // Mot-cl√© principal
          "faiblesses",
          // Variations de la question
          "faiblesses CRP MEMO",
          "points faibles",
          "limites CRP MEMO",
          // Termes sp√©cifiques
          "notori√©t√© faible",
          "march√© gestion projets",
          "structure start-up",
          // Termes g√©n√©raux et synonymes
          "d√©fauts logiciel",
          "inconv√©nients CRP MEMO",
          "faiblesse SWOT",
          // Phrases naturelles
          "restrictions CRP MEMO",
          "limites logiciel CRP MEMO",
          "points faibles SWOT"
        ]
      },
      {
        question: "Quelles sont les opportunit√©s ?",
        keyword: "opportunites",
        answer: "D√©mat√©rialisation, facturation √©lectronique 2027, march√© TPE, croissance du besoin en gestion externalis√©e.",
        keywords: [
          // Mot-cl√© principal
          "opportunites",
          // Variations de la question
          "opportunit√©s CRP MEMO",
          "perspectives CRP MEMO",
          "possibilit√©s march√©",
          // Termes sp√©cifiques
          "d√©mat√©rialisation",
          "facturation √©lectronique 2027",
          "march√© TPE",
          "gestion externalis√©e",
          // Termes g√©n√©raux et synonymes
          "chances CRP MEMO",
          "opportunit√©s de croissance",
          "avenirs CRP MEMO",
          // Phrases naturelles
          "potentiel march√© CRP MEMO",
          "opportunit√©s logiciel",
          "croissance CRP MEMO"
        ]
      },
      {
        question: "Quelles sont les menaces ?",
        keyword: "menaces",
        answer: "Concurrents puissants (SAGE, Salesforce), IA, r√©putation du pays de dev.",
        keywords: [
          // Mot-cl√© principal
          "menaces",
          // Variations de la question
          "menaces CRP MEMO",
          "risques CRP MEMO",
          "dangers march√©",
          // Termes sp√©cifiques
          "concurrents SAGE",
          "concurrents Salesforce",
          "IA concurrence",
          "r√©putation pays d√©veloppement",
          // Termes g√©n√©raux et synonymes
          "menaces SWOT",
          "obstacles CRP MEMO",
          "risques concurrentiels",
          // Phrases naturelles
          "concurrence CRP MEMO",
          "dangers logiciel CRP MEMO",
          "risques march√© CRP MEMO"
        ]
      },
    ],
  },
};

// Fonction pour normaliser le texte (supprimer accents, ponctuation, et convertir en minuscules)
function normalizeText(text) {
  return text
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "") // Supprimer les accents
    .replace(/[^\w\s]/g, "") // Supprimer la ponctuation
    .trim();
}

// Cr√©ation du mapping de mots-cl√©s
chatbotData.keywordMapping = {};

// Parcourir toutes les cat√©gories et questions pour construire le mapping
for (const category in chatbotData.reponses) {
  for (const questionObj of chatbotData.reponses[category]) {
    // Ajouter le mot-cl√© principal
    chatbotData.keywordMapping[normalizeText(questionObj.keyword)] = {
      question: questionObj.question,
      answer: questionObj.answer,
      keyword: questionObj.keyword,
    };
    
    // Ajouter tous les mots-cl√©s de la liste keywords
    for (const keyword of questionObj.keywords) {
      const normalizedKeyword = normalizeText(keyword);
      chatbotData.keywordMapping[normalizedKeyword] = {
        question: questionObj.question,
        answer: questionObj.answer,
        keyword: questionObj.keyword,
      };
    }
    
    // Ajouter la question elle-m√™me comme mot-cl√©
    const normalizedQuestion = normalizeText(questionObj.question);
    chatbotData.keywordMapping[normalizedQuestion] = {
      question: questionObj.question,
      answer: questionObj.answer,
      keyword: questionObj.keyword,
    };
  }
}

// Fonction de recherche optimis√©e
chatbotData.search = function (query) {
  const normalizedQuery = normalizeText(query);
  
  // 1. Recherche exacte du mot-cl√© ou de la question
  if (chatbotData.keywordMapping[normalizedQuery]) {
    return {
      question: chatbotData.keywordMapping[normalizedQuery].question,
      answer: chatbotData.keywordMapping[normalizedQuery].answer,
    };
  }

  // 2. Recherche par correspondance partielle stricte
  let bestMatch = null;
  let maxScore = 0;
  
  for (const keyword in chatbotData.keywordMapping) {
    const normalizedKeyword = normalizeText(keyword);
    
    // Calculer un score bas√© sur la correspondance
    let score = 0;
    if (normalizedQuery === normalizedKeyword) {
      score = 100; // Correspondance exacte
    } else if (normalizedQuery.includes(normalizedKeyword)) {
      score = 80 + (normalizedKeyword.length / normalizedQuery.length) * 20; // Contient le mot-cl√©
    } else if (normalizedKeyword.includes(normalizedQuery)) {
      score = 60 + (normalizedQuery.length / normalizedKeyword.length) * 20; // Mot-cl√© contient la requ√™te
    }
    
    if (score > maxScore) {
      maxScore = score;
      bestMatch = {
        question: chatbotData.keywordMapping[keyword].question,
        answer: chatbotData.keywordMapping[keyword].answer,
      };
    }
  }

  if (bestMatch && maxScore >= 60) {
    return bestMatch;
  }

  // 3. Recherche par mots individuels si pas de correspondance stricte
  const queryWords = normalizedQuery.split(/\s+/).filter(word => word.length > 2);
  let wordMatch = null;
  let maxWordScore = 0;

  for (const keyword in chatbotData.keywordMapping) {
    const normalizedKeyword = normalizeText(keyword);
    const keywordWords = normalizedKeyword.split(/\s+/).filter(word => word.length > 2);
    
    // Compter les mots communs
    const commonWords = queryWords.filter(word => keywordWords.includes(word));
    const wordScore = commonWords.length * 30; // Score bas√© sur le nombre de mots communs
    
    if (wordScore > maxWordScore) {
      maxWordScore = wordScore;
      wordMatch = {
        question: chatbotData.keywordMapping[keyword].question,
        answer: chatbotData.keywordMapping[keyword].answer,
      };
    }
  }

  if (wordMatch && maxWordScore >= 30) {
    return wordMatch;
  }

  // 4. Si aucune correspondance, retourner null
  return null;
};

export default chatbotData;