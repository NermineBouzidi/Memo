const chatbotData = {
  welcome_message: "ðŸ‘‹ Bonjour et bienvenue ! Je suis lÃ  pour rÃ©pondre Ã  vos questions sur CRP MEMO.",
  quick_replies: [
    { label: "Ã€ propos de CRP MEMO", payload: "about" },
    { label: "FonctionnalitÃ©s", payload: "features" },
    { label: "Avantages", payload: "benefits" },
    { label: "Tarification", payload: "pricing" },
    { label: "Mise en Å“uvre", payload: "implementation" },
    { label: "Public cible", payload: "target" },
    { label: "DÃ©tails techniques", payload: "technical" },
    { label: "Personnalisation", payload: "customization" },
    { label: "Marque & Contact", payload: "trademark" },
    { label: "SWOT", payload: "swot" },
  ],
  reponses: {
    about: [
      {
        question: "Quâ€™est-ce que CRP MEMO ?",
        keyword: "questcecrpmemo",
        answer: "CRP MEMO est une solution hybride entre un logiciel standard (type SAGE) et une solution sur mesure (type SAP), ajustÃ©e aux besoins mÃ©tiers.",
        keywords: [
          // Mot-clÃ© principal
          "questcecrpmemo",
          // Variations de la question
          "qu'est-ce que CRP MEMO",
          "CRP MEMO c'est quoi",
          "dÃ©finition CRP MEMO",
          "qu'est-ce que le CRP MEMO",
          // Termes spÃ©cifiques
          "logiciel hybride",
          "solution sur mesure",
          "besoins mÃ©tiers",
          // Termes gÃ©nÃ©raux et synonymes
          "prÃ©sentation CRP MEMO",
          "CRP MEMO logiciel",
          "description CRP MEMO",
          // Phrases naturelles
          "CRP MEMO explication",
          "quâ€™est-ce que fait CRP MEMO",
          "Ã  quoi sert CRP MEMO"
        ]
      },
      {
        question: "Quels sont les points forts du produit ?",
        keyword: "pointsforts",
        answer: "Sur-mesure, prix compÃ©titif, expertise mÃ©tier, dÃ©lai court, GED intÃ©grÃ©e, service client rÃ©actif, Ã©volutivitÃ©, tarification au forfait.",
        keywords: [
          // Mot-clÃ© principal
          "pointsforts",
          // Variations de la question
          "avantages CRP MEMO",
          "points forts produit",
          "atouts CRP MEMO",
          // Termes spÃ©cifiques
          "sur-mesure",
          "prix compÃ©titif",
          "expertise mÃ©tier",
          "GED intÃ©grÃ©e",
          "service client rÃ©actif",
          "Ã©volutivitÃ©",
          "tarification forfait",
          // Termes gÃ©nÃ©raux et synonymes
          "qualitÃ©s CRP MEMO",
          "bÃ©nÃ©fices produit",
          "forces CRP MEMO",
          // Phrases naturelles
          "pourquoi choisir CRP MEMO",
          "avantages du logiciel",
          "points forts CRP MEMO"
        ]
      },
    ],
    features: [
      {
        question: "Quelles sont les fonctionnalitÃ©s clÃ©s de CRP MEMO ?",
        keyword: "fonctionnalitescles",
        answer: "Suivi temps rÃ©el, gÃ©nÃ©ration dâ€™Ã©critures comptables, gestion RH, stocks, notes de frais, KPIs, prÃ©paration Ã  la facturation Ã©lectronique.",
        keywords: [
          // Mot-clÃ© principal
          "fonctionnalitescles",
          // Variations de la question
          "fonctions CRP MEMO",
          "caractÃ©ristiques CRP MEMO",
          "outils CRP MEMO",
          // Termes spÃ©cifiques
          "suivi temps rÃ©el",
          "Ã©critures comptables",
          "gestion RH",
          "gestion stocks",
          "notes de frais",
          "KPIs",
          "facturation Ã©lectronique",
          // Termes gÃ©nÃ©raux et synonymes
          "features CRP MEMO",
          "capacitÃ©s logiciel",
          "fonctionnalitÃ©s logiciel",
          // Phrases naturelles
          "ce que fait CRP MEMO",
          "outils proposÃ©s CRP MEMO",
          "fonctions principales"
        ]
      },
    ],
    benefits: [
      {
        question: "Quels sont les bÃ©nÃ©fices pour les clients ?",
        keyword: "beneficesclients",
        answer: "AmÃ©lioration rentabilitÃ©, rÃ©duction dÃ©lais paiement, centralisation des donnÃ©es, simplification administrative, accompagnement sur mesure.",
        keywords: [
          // Mot-clÃ© principal
          "beneficesclients",
          // Variations de la question
          "avantages pour clients",
          "bÃ©nÃ©fices CRP MEMO",
          "gains pour entreprise",
          // Termes spÃ©cifiques
          "amÃ©lioration rentabilitÃ©",
          "rÃ©duction dÃ©lais paiement",
          "centralisation donnÃ©es",
          "simplification administrative",
          "accompagnement sur mesure",
          // Termes gÃ©nÃ©raux et synonymes
          "intÃ©rÃªts CRP MEMO",
          "valeur ajoutÃ©e",
          "avantages utilisateurs",
          // Phrases naturelles
          "pourquoi choisir CRP MEMO",
          "bÃ©nÃ©fices utilisateurs",
          "avantages pour entreprise"
        ]
      },
    ],
    pricing: [
      {
        question: "Quel est le modÃ¨le de tarification ?",
        keyword: "modeletarification",
        answer: "Conception au forfait, utilisation sans rÃ©currence, maintenance mensuelle faible, assistance illimitÃ©e sans engagement.",
        keywords: [
          // Mot-clÃ© principal
          "modeletarification",
          // Variations de la question
          "tarifs CRP MEMO",
          "coÃ»t CRP MEMO",
          "prix logiciel",
          // Termes spÃ©cifiques
          "conception forfait",
          "utilisation sans rÃ©currence",
          "maintenance mensuelle",
          "assistance illimitÃ©e",
          // Termes gÃ©nÃ©raux et synonymes
          "modÃ¨le de prix",
          "tarification CRP MEMO",
          "budget CRP MEMO",
          // Phrases naturelles
          "frais d'utilisation",
          "coÃ»t usage CRP MEMO",
          "tarifs logiciel CRP MEMO"
        ]
      },
    ],
    implementation: [
      {
        question: "Comment CRP MEMO est-il mis en place dans mon entreprise ?",
        keyword: "miseoeuvre",
        answer: "La mise en Å“uvre inclut une phase pilote, une collaboration avec votre Ã©quipe MOA, et une intÃ©gration des processus mÃ©tier, rÃ©alisÃ©e dans un dÃ©lai court.",
        keywords: [
          // Mot-clÃ© principal
          "miseoeuvre",
          // Variations de la question
          "mise en place CRP MEMO",
          "implÃ©mentation logiciel",
          "dÃ©ploiement CRP MEMO",
          // Termes spÃ©cifiques
          "phase pilote",
          "collaboration MOA",
          "intÃ©gration processus mÃ©tier",
          "dÃ©lai court",
          // Termes gÃ©nÃ©raux et synonymes
          "installation CRP MEMO",
          "processus mise en Å“uvre",
          "intÃ©gration logiciel",
          // Phrases naturelles
          "comment installer CRP MEMO",
          "dÃ©ploiement CRP MEMO entreprise",
          "mise en Å“uvre logiciel"
        ]
      },
    ],
    target: [
      {
        question: "Ã€ qui sâ€™adresse CRP MEMO ?",
        keyword: "publiccible",
        answer: "Aux TPE/PME, associations, cabinets dâ€™architecture, agences web, BTP, sÃ©curitÃ©, entre 2 et 100 salariÃ©s et jusquâ€™Ã  50Mâ‚¬ de CA annuel.",
        keywords: [
          // Mot-clÃ© principal
          "publiccible",
          // Variations de la question
          "cible CRP MEMO",
          "qui utilise CRP MEMO",
          "clients CRP MEMO",
          // Termes spÃ©cifiques
          "TPE PME",
          "associations",
          "cabinets architecture",
          "agences web",
          "BTP",
          "sÃ©curitÃ©",
          "2 Ã  100 salariÃ©s",
          "50Mâ‚¬ CA annuel",
          // Termes gÃ©nÃ©raux et synonymes
          "audience CRP MEMO",
          "utilisateurs cibles",
          "entreprises concernÃ©es",
          // Phrases naturelles
          "profils clients CRP MEMO",
          "qui peut utiliser CRP MEMO",
          "entreprises adaptÃ©es CRP MEMO"
        ]
      },
    ],
    technical: [
      {
        question: "Qui dÃ©veloppe et hÃ©berge CRP MEMO ?",
        keyword: "developpementhebergement",
        answer: "PEGASIO INTERNATIONAL / EQUITY BUSINESS, avec des Ã©quipes en Tunisie et Ukraine (OVH, DigitalOcean, Maligun, Brevo).",
        keywords: [
          // Mot-clÃ© principal
          "developpementhebergement",
          // Variations de la question
          "qui dÃ©veloppe CRP MEMO",
          "hÃ©bergement CRP MEMO",
          "serveurs CRP MEMO",
          // Termes spÃ©cifiques
          "PEGASIO INTERNATIONAL",
          "EQUITY BUSINESS",
          "Ã©quipes Tunisie",
          "Ã©quipes Ukraine",
          "OVH",
          "DigitalOcean",
          "Maligun",
          "Brevo",
          // Termes gÃ©nÃ©raux et synonymes
          "dÃ©veloppeurs logiciel",
          "infrastructure CRP MEMO",
          "qui hÃ©berge CRP MEMO",
          // Phrases naturelles
          "Ã©quipe technique CRP MEMO",
          "serveurs utilisÃ©s CRP MEMO",
          "dÃ©veloppement logiciel CRP MEMO"
        ]
      },
    ],
    customization: [
      {
        question: "CRP MEMO peut-il Ãªtre adaptÃ© Ã  mon entreprise ?",
        keyword: "adaptation",
        answer: "Oui, 30-40 % de ses fonctionnalitÃ©s peuvent Ãªtre personnalisÃ©es en collaboration avec votre Ã©quipe MOA.",
        keywords: [
          // Mot-clÃ© principal
          "adaptation",
          // Variations de la question
          "personnalisation CRP MEMO",
          "adaptation entreprise",
          "sur mesure CRP MEMO",
          // Termes spÃ©cifiques
          "30-40 % fonctionnalitÃ©s",
          "collaboration MOA",
          "personnalisation fonctionnalitÃ©s",
          // Termes gÃ©nÃ©raux et synonymes
          "customisation logiciel",
          "ajustement CRP MEMO",
          "modifications possibles",
          // Phrases naturelles
          "personnaliser CRP MEMO",
          "adapter logiciel entreprise",
          "sur mesure logiciel CRP MEMO"
        ]
      },
    ],
    trademark: [
      {
        question: "Quel est le statut de la marque CRP MEMO ?",
        keyword: "statutmarque",
        answer: "CRP MEMO est une marque franÃ§aise enregistrÃ©e (nÂ° 5012862) dÃ©posÃ©e le 08-12-2023 auprÃ¨s de l'INPI.",
        keywords: [
          // Mot-clÃ© principal
          "statutmarque",
          // Variations de la question
          "marque CRP MEMO",
          "enregistrement marque",
          "statut juridique marque",
          // Termes spÃ©cifiques
          "marque franÃ§aise",
          "nÂ° 5012862",
          "08-12-2023",
          "INPI",
          // Termes gÃ©nÃ©raux et synonymes
          "propriÃ©tÃ© marque",
          "marque dÃ©posÃ©e",
          "dÃ©tails marque",
          // Phrases naturelles
          "statut lÃ©gal CRP MEMO",
          "enregistrement INPI",
          "marque CRP MEMO dÃ©tails"
        ]
      },
      {
        question: "Comment puis-je contacter le support CRP MEMO ?",
        keyword: "contactsupport",
        answer: "Vous pouvez nous Ã©crire Ã  contact@hable-solutions.com ou appeler au 07 67 27 65 22.",
        keywords: [
          // Mot-clÃ© principal
          "contactsupport",
          // Variations de la question
          "contacter support",
          "assistance CRP MEMO",
          "joindre support",
          // Termes spÃ©cifiques
          "contact@hable-solutions.com",
          "07 67 27 65 22",
          "email support",
          "numÃ©ro support",
          // Termes gÃ©nÃ©raux et synonymes
          "service client",
          "contact Ã©quipe",
          "support client",
          // Phrases naturelles
          "appeler support CRP MEMO",
          "email assistance CRP MEMO",
          "contacter Ã©quipe CRP MEMO"
        ]
      },
    ],
    swot: [
      {
        question: "Quels sont les points forts (SWOT) ?",
        keyword: "pointsfortsswot",
        answer: "Interface simple, dÃ©lai court, adaptation comptable, GED, consulting, flexibilitÃ©, plateforme en ligne, rÃ©activitÃ©, expertise.",
        keywords: [
          // Mot-clÃ© principal
          "pointsfortsswot",
          // Variations de la question
          "forces SWOT",
          "atouts SWOT",
          "points forts CRP MEMO",
          // Termes spÃ©cifiques
          "interface simple",
          "dÃ©lai court",
          "adaptation comptable",
          "GED",
          "consulting",
          "flexibilitÃ©",
          "plateforme en ligne",
          "rÃ©activitÃ©",
          "expertise",
          // Termes gÃ©nÃ©raux et synonymes
          "avantages SWOT",
          "qualitÃ©s SWOT",
          "bÃ©nÃ©fices SWOT",
          // Phrases naturelles
          "forces CRP MEMO",
          "atouts logiciel CRP MEMO",
          "points forts analyse SWOT"
        ]
      },
      {
        question: "Quelles sont les faiblesses ?",
        keyword: "faiblesses",
        answer: "NotoriÃ©tÃ© faible, marchÃ© restreint Ã  la gestion de projets, structure en mode start-up.",
        keywords: [
          // Mot-clÃ© principal
          "faiblesses",
          // Variations de la question
          "faiblesses CRP MEMO",
          "points faibles",
          "limites CRP MEMO",
          // Termes spÃ©cifiques
          "notoriÃ©tÃ© faible",
          "marchÃ© gestion projets",
          "structure start-up",
          // Termes gÃ©nÃ©raux et synonymes
          "dÃ©fauts logiciel",
          "inconvÃ©nients CRP MEMO",
          "faiblesse SWOT",
          // Phrases naturelles
          "restrictions CRP MEMO",
          "limites logiciel CRP MEMO",
          "points faibles SWOT"
        ]
      },
      {
        question: "Quelles sont les opportunitÃ©s ?",
        keyword: "opportunites",
        answer: "DÃ©matÃ©rialisation, facturation Ã©lectronique 2027, marchÃ© TPE, croissance du besoin en gestion externalisÃ©e.",
        keywords: [
          // Mot-clÃ© principal
          "opportunites",
          // Variations de la question
          "opportunitÃ©s CRP MEMO",
          "perspectives CRP MEMO",
          "possibilitÃ©s marchÃ©",
          // Termes spÃ©cifiques
          "dÃ©matÃ©rialisation",
          "facturation Ã©lectronique 2027",
          "marchÃ© TPE",
          "gestion externalisÃ©e",
          // Termes gÃ©nÃ©raux et synonymes
          "chances CRP MEMO",
          "opportunitÃ©s de croissance",
          "avenirs CRP MEMO",
          // Phrases naturelles
          "potentiel marchÃ© CRP MEMO",
          "opportunitÃ©s logiciel",
          "croissance CRP MEMO"
        ]
      },
      {
        question: "Quelles sont les menaces ?",
        keyword: "menaces",
        answer: "Concurrents puissants (SAGE, Salesforce), IA, rÃ©putation du pays de dev.",
        keywords: [
          // Mot-clÃ© principal
          "menaces",
          // Variations de la question
          "menaces CRP MEMO",
          "risques CRP MEMO",
          "dangers marchÃ©",
          // Termes spÃ©cifiques
          "concurrents SAGE",
          "concurrents Salesforce",
          "IA concurrence",
          "rÃ©putation pays dÃ©veloppement",
          // Termes gÃ©nÃ©raux et synonymes
          "menaces SWOT",
          "obstacles CRP MEMO",
          "risques concurrentiels",
          // Phrases naturelles
          "concurrence CRP MEMO",
          "dangers logiciel CRP MEMO",
          "risques marchÃ© CRP MEMO"
        ]
      },
    ],
  },
};

// Fonction pour normaliser le texte (supprimer accents, ponctuation, et convertir en minuscules)
function normalizeText(text) {
  return text
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "") // Supprimer les accents
    .replace(/[^\w\s]/g, "") // Supprimer la ponctuation
    .trim();
}

// CrÃ©ation du mapping de mots-clÃ©s
chatbotData.keywordMapping = {};

// Parcourir toutes les catÃ©gories et questions pour construire le mapping
for (const category in chatbotData.reponses) {
  for (const questionObj of chatbotData.reponses[category]) {
    // Ajouter le mot-clÃ© principal
    chatbotData.keywordMapping[normalizeText(questionObj.keyword)] = {
      question: questionObj.question,
      answer: questionObj.answer,
      keyword: questionObj.keyword,
    };
    
    // Ajouter tous les mots-clÃ©s de la liste keywords
    for (const keyword of questionObj.keywords) {
      const normalizedKeyword = normalizeText(keyword);
      chatbotData.keywordMapping[normalizedKeyword] = {
        question: questionObj.question,
        answer: questionObj.answer,
        keyword: questionObj.keyword,
      };
    }
    
    // Ajouter la question elle-mÃªme comme mot-clÃ©
    const normalizedQuestion = normalizeText(questionObj.question);
    chatbotData.keywordMapping[normalizedQuestion] = {
      question: questionObj.question,
      answer: questionObj.answer,
      keyword: questionObj.keyword,
    };
  }
}

// Fonction de recherche optimisÃ©e
chatbotData.search = function (query) {
  const normalizedQuery = normalizeText(query);
  
  // 1. Recherche exacte du mot-clÃ© ou de la question
  if (chatbotData.keywordMapping[normalizedQuery]) {
    return {
      question: chatbotData.keywordMapping[normalizedQuery].question,
      answer: chatbotData.keywordMapping[normalizedQuery].answer,
    };
  }

  // 2. Recherche par correspondance partielle stricte
  let bestMatch = null;
  let maxScore = 0;
  
  for (const keyword in chatbotData.keywordMapping) {
    const normalizedKeyword = normalizeText(keyword);
    
    // Calculer un score basÃ© sur la correspondance
    let score = 0;
    if (normalizedQuery === normalizedKeyword) {
      score = 100; // Correspondance exacte
    } else if (normalizedQuery.includes(normalizedKeyword)) {
      score = 80 + (normalizedKeyword.length / normalizedQuery.length) * 20; // Contient le mot-clÃ©
    } else if (normalizedKeyword.includes(normalizedQuery)) {
      score = 60 + (normalizedQuery.length / normalizedKeyword.length) * 20; // Mot-clÃ© contient la requÃªte
    }
    
    if (score > maxScore) {
      maxScore = score;
      bestMatch = {
        question: chatbotData.keywordMapping[keyword].question,
        answer: chatbotData.keywordMapping[keyword].answer,
      };
    }
  }

  if (bestMatch && maxScore >= 60) {
    return bestMatch;
  }

  // 3. Recherche par mots individuels si pas de correspondance stricte
  const queryWords = normalizedQuery.split(/\s+/).filter(word => word.length > 2);
  let wordMatch = null;
  let maxWordScore = 0;

  for (const keyword in chatbotData.keywordMapping) {
    const normalizedKeyword = normalizeText(keyword);
    const keywordWords = normalizedKeyword.split(/\s+/).filter(word => word.length > 2);
    
    // Compter les mots communs
    const commonWords = queryWords.filter(word => keywordWords.includes(word));
    const wordScore = commonWords.length * 30; // Score basÃ© sur le nombre de mots communs
    
    if (wordScore > maxWordScore) {
      maxWordScore = wordScore;
      wordMatch = {
        question: chatbotData.keywordMapping[keyword].question,
        answer: chatbotData.keywordMapping[keyword].answer,
      };
    }
  }

  if (wordMatch && maxWordScore >= 30) {
    return wordMatch;
  }

  // 4. Si aucune correspondance, retourner null
  return null;
};

export default chatbotData;